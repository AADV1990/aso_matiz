<ui:component xmlns="http://www.w3.org/1999/xhtml"
              xmlns:ui="http://java.sun.com/jsf/facelets"
              xmlns:h="http://java.sun.com/jsf/html"
              xmlns:p="http://primefaces.org/ui"
              xmlns:f="http://java.sun.com/jsf/core"
              xmlns:composite="http://java.sun.com/jsf/composite"
              xmlns:comp="jakarta.faces.composite.componentes">

    <composite:interface>
        <composite:attribute name="controlador" required="true"/>
        <composite:attribute name="nombreForma" required="true"/>
        <composite:attribute name="dataTable" required="true"/>
        <composite:attribute name="abmForm" required="true"/>
        <composite:attribute name="dlgForm" required="false"/>
        <composite:attribute name="icono" required="false" default="pi pi-list"/>
    </composite:interface>

    <composite:implementation>

        <h:form id="form" style="width:100%" enctype="multipart/form-data">
            <p:growl id="growl" showDetail="true" life="5000" />

            <!-- Barra superior con título y acciones -->
            <p:toolbar id="toolbar" style="margin-bottom:1rem">
                <p:toolbarGroup align="left">
                    <h2 style="margin:0">
                        <i class="#{cc.attrs.icono}" style="margin-right:.5rem" />
                        #{cc.attrs.nombreForma}
                    </h2>
                </p:toolbarGroup>

                <p:toolbarGroup align="right">
                    <!-- Botón Nuevo (solo cuando NO está en edición) -->
                    <p:commandButton icon="pi pi-plus"
                                     value="Nuevo"
                                     action="#{cc.attrs.controlador.nuevo}"
                                     process="@this"
                                     update="zonaABM toolbar"
                                     rendered="#{!cc.attrs.controlador.enEdicion}" />

                    <!-- Botón Guardar (solo en edición) -->
                    <p:commandButton icon="pi pi-save"
                                     value="Guardar"
                                     action="#{cc.attrs.controlador.guardar}"
                                     process="@form"
                                     update="zonaABM toolbar growl"
                                     rendered="#{cc.attrs.controlador.enEdicion}" />

                    <!-- Botón Cancelar (solo en edición) -->
                    <p:commandButton icon="pi pi-times"
                                     value="Cancelar"
                                     action="#{cc.attrs.controlador.cancelarEdicion}"
                                     process="@this"
                                     update="zonaABM toolbar"
                                     rendered="#{cc.attrs.controlador.enEdicion}"/>
                </p:toolbarGroup>
            </p:toolbar>

            <!-- Contenedor conmutado: lista vs formulario -->
            <p:outputPanel id="zonaABM" deferred="true" deferredMode="visible">
                <!-- Tabla -->
                <ui:fragment rendered="#{!cc.attrs.controlador.enEdicion}">
                    <ui:include src="#{cc.attrs.dataTable}" />
                </ui:fragment>

                <!-- Formulario -->
                <ui:fragment rendered="#{cc.attrs.controlador.enEdicion}">
                    <div class="card contenido-centrado">
                        <h2 class="mb-4">#{cc.attrs.nombreForma}</h2>
                        <ui:include src="#{cc.attrs.abmForm}" />
                    </div>
                </ui:fragment>
            </p:outputPanel>

            <!-- Diálogo opcional -->
            <ui:fragment rendered="#{not empty cc.attrs.dlgForm}">
                <ui:include src="#{cc.attrs.dlgForm}" />
            </ui:fragment>

        </h:form>

    </composite:implementation>
</ui:component>
